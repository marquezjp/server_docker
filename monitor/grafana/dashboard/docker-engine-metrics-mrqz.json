{
  "title": "Docker Engine Metrics - MRQZ",
  "uid": "docker-engine-metrics-mrqz",
  "tags": ["Docker", "Docker Metrics", "Docker Engine", "Prometheus"],
  "timezone": "browser",
  "schemaVersion": 38,
  "version": 1,
  "style": "dark",
  "refresh": "15s",
  "editable": true,

  "description": "Draw some docker metrics",
  "fiscalYearStartMonth": 0,
  "graphTooltip": 0,
  "links": [],
  "preload": false,

  "__inputs": [
    {
      "name": "DS_PROMETHEUS",
      "label": "Prometheus",
      "type": "datasource",
      "pluginId": "prometheus",
      "pluginName": "Prometheus"
    }
  ],

  "__requires": [
    { "type": "grafana", "id": "grafana", "name": "Grafana", "version": "9.5.0" },
    { "type": "datasource", "id": "prometheus", "name": "Prometheus", "version": "2.9.0" },

    { "type": "panel", "id": "row", "name": "Servidor"},
    { "type": "panel", "id": "gauge", "name": "CPU [%]"},
    { "type": "panel", "id": "gauge", "name": "Memória"},
    { "type": "panel", "id": "gauge", "name": "Disco Raiz"},
    { "type": "panel", "id": "gauge", "name": "Disco Docker"},
    { "type": "panel", "id": "stat", "name": "Tráfego de Rede Recebido [B/s, 5m média]"},
    { "type": "panel", "id": "stat", "name": "Tráfego de Rede Enviado [B/s, 5m média]"},

    { "type": "panel", "id": "row", "name": "CPU Container"},
    { "type": "panel", "id": "timeseries", "name": "CPU [%]"},

    { "type": "panel", "id": "row", "name": "Memória Container"},
    { "type": "panel", "id": "timeseries", "name": "Memória"},
    { "type": "panel", "id": "timeseries", "name": "Memória Cached"},

    { "type": "panel", "id": "row", "name": "Network Container"},
    { "type": "panel", "id": "timeseries", "name": "Tráfego de Rede Recebido por Container"},
    { "type": "panel", "id": "timeseries", "name": "Tráfego de Rede Enviado por Container"},

    { "type": "panel", "id": "row", "name": "Informações dos Containers"},
    { "type": "panel", "id": "table", "name": "Informações dos Containers"}
  ],

  "annotations": {
    "list": [
      {
        "builtIn": 1,
        "datasource": "${DS_PROMETHEUS}",
        "enable": true,
        "hide": true,
        "iconColor": "rgba(0, 211, 255, 1)",
        "name": "Annotations & Alerts",
        "type": "dashboard"
      }
    ]
  },

  "templating": {
    "list": [
      {
        "label": "Container",
        "name": "container_name",
        "type": "query",
        "refresh": 1,
        "regex": "",
        "allValue": ".*",
        "includeAll": true,
        "options": [],
        "current": {"text": "All", "value": "$__all"},
        "datasource": "${DS_PROMETHEUS}",
        "definition": "label_values({__name__=~\"container.*\"},name)",
        "query": {
          "query": "label_values(container_memory_usage_bytes{image!=\"\",name!=\"\"}, name)",
          "refId": "Prometheus-container-Variable-Query"
        }
      }
    ]
  },

  "time": { "from": "now-6h", "to": "now" },
  "timepicker": { "refresh_intervals": ["5s","10s","15s","30s","1m","5m","15m"] },

  "panels":[

    {
        "title":"Server",
        "type":"row", "collapsed":false, "panels":[],
        "gridPos": { "h": 8, "w": 12, "x": 0, "y": 0 }
    },
    {
      "type": "gauge",
      "title": "CPU (%)",
      "datasource": "${DS_PROMETHEUS}",
      "gridPos": { "h": 5, "w": 6, "x": 0, "y": 0 },
      "targets": [
        {"expr": "100 - (avg(irate(node_cpu_seconds_total{mode=\"idle\"}[5m])) * 100)", "refId": "A"}
      ],
      "fieldConfig": {
        "defaults": {
          "unit": "percent","min": 0,"max": 100,
          "thresholds": { "mode": "absolute","steps": [
            { "color": "green" }, { "color": "orange", "value": 70 }, { "color": "red", "value": 90 }
          ]}
        }
      },
      "options": { "reduceOptions": { "calcs": ["lastNotNull"], "values": false } }
    },
    {
      "type": "gauge",
      "title": "Memória",
      "datasource": "${DS_PROMETHEUS}",
      "gridPos": { "h": 5, "w": 6, "x": 6, "y": 0 },
      "targets": [
        {"expr": "(node_memory_MemTotal_bytes - node_memory_MemAvailable_bytes)", "refId": "A"}
      ],
      "fieldConfig": {
        "defaults": {
          "unit": "bytes",
          "min": 0,
          "max": 68719476736,
          "thresholds": { "mode": "absolute","steps": [
            { "color": "green" }, { "color": "orange", "value": 51539607552 }, { "color": "red", "value": 60129542144 }
          ]}
        }
      },
      "options": { "reduceOptions": { "calcs": ["lastNotNull"], "values": false } }
    },
    {
      "type": "gauge",
      "title": "Disco Raiz",
      "datasource": "${DS_PROMETHEUS}",
      "gridPos": { "h": 5, "w": 6, "x": 12, "y": 0 },
      "targets": [
        {"expr": "100 - ((node_filesystem_avail_bytes{mountpoint=\"/\"} * 100)/node_filesystem_size_bytes{mountpoint=\"/\"})", "refId": "A"}
      ],
      "fieldConfig": { "defaults": { "unit": "percent","min": 0,"max": 100 } },
      "options": { "reduceOptions": { "calcs": ["lastNotNull"], "values": false } }
    },
    {
      "type": "gauge",
      "title": "Disco Docker",
      "datasource": "${DS_PROMETHEUS}",
      "gridPos": { "h": 5, "w": 6, "x": 18, "y": 0 },
      "targets": [
        {"expr": "100 - ((node_filesystem_avail_bytes{mountpoint=\"/var/lib/docker\"} * 100)/node_filesystem_size_bytes{mountpoint=\"/var/lib/docker\"})", "refId": "A"}
      ],
      "fieldConfig": { "defaults": { "unit": "percent","min": 0,"max": 100 } },
      "options": { "reduceOptions": { "calcs": ["lastNotNull"], "values": false } }
    },

    {
      "title": "Tráfego de Rede Recebido [B/s, 5m média]",
      "type": "stat",
      "datasource": "${DS_PROMETHEUS}",
      "gridPos": { "h": 4, "w": 12, "x": 0, "y": 5 },
      "targets": [
        {"expr": "sum(rate(node_network_receive_bytes_total{device!~\"lo|veth.*\"}[5m]))", "refId": "A"}
      ],
      "fieldConfig": { "defaults": { "unit": "bytespersecond", "decimals": 2 } },
      "options": { "reduceOptions": { "calcs": ["lastNotNull"] } }
    },
    {
      "title": "Tráfego de Rede Enviado [B/s, 5m média]",
      "type": "stat",
      "datasource": "${DS_PROMETHEUS}",
      "gridPos": { "h": 4, "w": 12, "x": 12, "y": 5 },
      "targets": [
        {"expr": "sum(rate(node_network_transmit_bytes_total{device!~\"lo|veth.*\"}[5m]))", "refId": "A"}
      ],
      "fieldConfig": { "defaults": { "unit": "bytespersecond", "decimals": 2 } },
      "options": { "reduceOptions": { "calcs": ["lastNotNull"] } }
    },

    {
        "title":"CPU Containers",
        "type":"row", "collapsed":false, "panels":[],
        "gridPos": { "h": 8, "w": 24, "x": 0, "y": 9 }
    },
    {
        "title":"CPU [%]",
        "type":"timeseries",
        "datasource": "${DS_PROMETHEUS}",
        "gridPos": { "h": 8, "w": 24, "x": 0, "y": 9 },
        "targets":[
            {"expr":"sum(rate(container_cpu_usage_seconds_total{name=~\"$container_name\",name=~\".+\"}[5m])) by (name) *100","hide":false,"legendFormat":"{{name}}","refId":"A"}
        ],
        "fieldConfig":{"defaults":{"color":{"mode":"palette-classic"},"custom":{"axisBorderShow":false,"axisCenteredZero":false,"axisColorMode":"text","axisLabel":"","axisPlacement":"auto","barAlignment":0,"barWidthFactor":0.6,"drawStyle":"line","fillOpacity":0,"gradientMode":"none","hideFrom":{"legend":false,"tooltip":false,"viz":false},"insertNulls":false,"lineInterpolation":"linear","lineWidth":1,"pointSize":5,"scaleDistribution":{"type":"linear"},"showPoints":"never","spanNulls":false,"stacking":{"group":"A","mode":"normal"},"thresholdsStyle":{"mode":"off"}},"mappings":[],"thresholds":{"mode":"absolute","steps":[{"color":"green"},{"color":"red","value":80}]},"unit":"percent"},"overrides":[]},
        "options":{"legend":{"calcs":["mean","max"],"displayMode":"table","placement":"right","showLegend":true},"tooltip":{"hideZeros":false,"maxHeight":600,"mode":"multi","sort":"none"}}
    },
    {
        "title":"Memória Containers",
        "type":"row", "collapsed":false,"panels":[],
        "gridPos": { "h": 8, "w": 24, "x": 0, "y": 17 }
    },
    {
        "title":"Memória Containers",
        "type":"timeseries",
        "datasource": "${DS_PROMETHEUS}",
        "gridPos": { "h": 8, "w": 24, "x": 0, "y": 17 },
        "targets":[
            {"expr":"sum(container_memory_rss{name=~\"$container_name\",name=~\".+\"}) by (name)","hide":false,"legendFormat":"{{name}}","refId":"A"}
        ],
        "fieldConfig":{"defaults":{"color":{"mode":"palette-classic"},"custom":{"axisBorderShow":false,"axisCenteredZero":false,"axisColorMode":"text","axisLabel":"","axisPlacement":"auto","barAlignment":0,"barWidthFactor":0.6,"drawStyle":"line","fillOpacity":0,"gradientMode":"none","hideFrom":{"legend":false,"tooltip":false,"viz":false},"insertNulls":false,"lineInterpolation":"linear","lineWidth":1,"pointSize":5,"scaleDistribution":{"type":"linear"},"showPoints":"never","spanNulls":false,"stacking":{"group":"A","mode":"normal"},"thresholdsStyle":{"mode":"off"}},"mappings":[],"thresholds":{"mode":"absolute","steps":[{"color":"green"},{"color":"red","value":80}]},"unit":"bytes"},"overrides":[]},
        "options":{"legend":{"calcs":["mean","max"],"displayMode":"table","placement":"right","showLegend":true},"tooltip":{"hideZeros":false,"maxHeight":600,"mode":"multi","sort":"none"}}
    },
    {
        "title":"Memória Cached Containers",
        "type":"timeseries",
        "datasource": "${DS_PROMETHEUS}",
        "gridPos": { "h": 8, "w": 24, "x": 0, "y": 25 },
        "targets":[
            {"expr":"sum(container_memory_cache{name=~\"$container_name\",name=~\".+\"}) by (name)","hide":false,"legendFormat":"{{name}}","refId":"A"}
        ],
        "fieldConfig":{"defaults":{"color":{"mode":"palette-classic"},"custom":{"axisBorderShow":false,"axisCenteredZero":false,"axisColorMode":"text","axisLabel":"","axisPlacement":"auto","barAlignment":0,"barWidthFactor":0.6,"drawStyle":"line","fillOpacity":0,"gradientMode":"none","hideFrom":{"legend":false,"tooltip":false,"viz":false},"insertNulls":false,"lineInterpolation":"linear","lineWidth":1,"pointSize":5,"scaleDistribution":{"type":"linear"},"showPoints":"never","spanNulls":false,"stacking":{"group":"A","mode":"normal"},"thresholdsStyle":{"mode":"off"}},"mappings":[],"thresholds":{"mode":"absolute","steps":[{"color":"green"},{"color":"red","value":80}]},"unit":"bytes"},"overrides":[]},
        "options":{"legend":{"calcs":["mean","max"],"displayMode":"table","placement":"right","showLegend":true},"tooltip":{"hideZeros":false,"maxHeight":600,"mode":"multi","sort":"none"}}
    },
    {
        "title":"Tráfego de Rede por Containers",
        "type":"row", "collapsed":false, "panels":[],
        "gridPos": { "h": 8, "w": 24, "x": 0, "y": 33 }
    },
    {
        "title":"Tráfego de Rede Recebido por Containers [B/s, 5m média]",
        "type":"timeseries",
        "datasource": "${DS_PROMETHEUS}",
        "gridPos": { "h": 8, "w": 24, "x": 0, "y": 33 },
        "targets":[
            {"expr":"sum(rate(container_network_receive_bytes_total{name=~\"$container_name\",name=~\".+\"}[5m])) by (name)","hide":false,"legendFormat":"{{name}}","refId":"A"}
        ],
        "fieldConfig":{"defaults":{"color":{"mode":"palette-classic"},"custom":{"axisBorderShow":false,"axisCenteredZero":false,"axisColorMode":"text","axisLabel":"","axisPlacement":"auto","barAlignment":0,"drawStyle":"line","fillOpacity":0,"gradientMode":"none","hideFrom":{"legend":false,"tooltip":false,"viz":false},"insertNulls":false,"lineInterpolation":"linear","lineWidth":1,"pointSize":5,"scaleDistribution":{"type":"linear"},"showPoints":"never","spanNulls":false,"stacking":{"group":"A","mode":"none"},"thresholdsStyle":{"mode":"off"}},"mappings":[],"thresholds":{"mode":"absolute","steps":[{"color":"green"},{"color":"red","value":80}]},"unit":"Bps"},"overrides":[]},
        "options":{"legend":{"calcs":["mean","max"],"displayMode":"table","placement":"right","showLegend":true},"tooltip":{"maxHeight":600,"mode":"multi","sort":"none"}}
    },
    {
        "title":"Tráfego de Rede Enviado por Containers [B/s, 5m média]",
        "type":"timeseries",
        "datasource": "${DS_PROMETHEUS}",
        "gridPos": { "h": 8, "w": 24, "x": 0, "y": 41 },
        "targets":[
            {"expr":"sum(rate(container_network_transmit_bytes_total{name=~\"$container_name\",name=~\".+\"}[5m])) by (name)","legendFormat":"{{name}}","refId":"A"}
        ],
        "fieldConfig":{"defaults":{"color":{"mode":"palette-classic"},"custom":{"axisBorderShow":false,"axisCenteredZero":false,"axisColorMode":"text","axisLabel":"","axisPlacement":"auto","barAlignment":0,"drawStyle":"line","fillOpacity":0,"gradientMode":"none","hideFrom":{"legend":false,"tooltip":false,"viz":false},"insertNulls":false,"lineInterpolation":"linear","lineWidth":1,"pointSize":5,"scaleDistribution":{"type":"linear"},"showPoints":"never","spanNulls":false,"stacking":{"group":"A","mode":"none"},"thresholdsStyle":{"mode":"off"}},"mappings":[],"thresholds":{"mode":"absolute","steps":[{"color":"green"},{"color":"red","value":80}]},"unit":"Bps"},"overrides":[]},
        "options":{"legend":{"calcs":["mean","max"],"displayMode":"table","placement":"right","showLegend":true},"tooltip":{"maxHeight":600,"mode":"multi","sort":"none"}}
    },
    {
        "title":"Informações dos Containers",
        "type":"row", "collapsed":false, "panels":[],
        "gridPos": { "h": 8, "w": 24, "x": 0, "y": 49 }
    },
    {
        "title":"Informações dos Containers",
        "type":"table",
        "datasource": "${DS_PROMETHEUS}",
        "gridPos": { "h": 8, "w": 24, "x": 0, "y": 49 },
        "targets":[
            {"expr":"(time() - container_start_time_seconds{name=~\".+\"})/86400","format":"table","instant":true,"legendFormat":"{{name}}","refId":"A"}
        ],
        "fieldConfig":{"defaults":{"custom":{"cellOptions":{"type":"auto"},"filterable":false,"inspect":false},"mappings":[],"thresholds":{"mode":"absolute","steps":[{"color":"green"},{"color":"red","value":80}]}},"overrides":[{"matcher":{"id":"byName","options":"id"},"properties":[{"id":"custom.width","value":260}]},{"matcher":{"id":"byName","options":"Running"},"properties":[{"id":"unit","value":"d"},{"id":"decimals","value":1},{"id":"custom.cellOptions","value":{"type":"color-text"}},{"id":"color","value":{"fixedColor":"dark-green","mode":"fixed"}}]}]},
        "options":{"cellHeight":"sm","footer":{"countRows":false,"fields":"","reducer":["sum"],"show":false},"showHeader":true,"sortBy":[]},
        "transformations":[
            {"id":"filterFieldsByName", "options":{"include":{"names":["container_label_com_docker_compose_project", "name", "image", "Value"]}}},
            {"id":"organize", "options":{"excludeByName":{}, "indexByName":{}, "renameByName":{"container_label_com_docker_compose_project":"Stack", "name":"Container", "image":"Image", "Value":"Iniciado [Horas]"}}}
        ]
    }
  ]
}