# Redireciona HTTP -> HTTPS
server {
  listen 80;
  listen [::]:80;
  server_name cockpit.mrqz.me;
  return 301 https://$host$request_uri;
}

# HTTPS -> Cockpit (no HOST via HTTP)
server {
  listen 443 ssl;
  listen [::]:443 ssl;
  http2 on;

  server_name cockpit.mrqz.me;

  # SSL centralizado
  include /etc/nginx/snippets/ssl-mrqz.conf;

  # Proxy padrão + WebSockets
  include /etc/nginx/snippets/proxy-common.conf;

  # Cabeçalhos extras p/ apps atrás de proxy
  proxy_set_header X-Forwarded-Host   $host;
  proxy_set_header X-Forwarded-Port   443;

  # Evita que o Cockpit reescreva Location para :9090 (fallback)
  proxy_redirect off;

  location / {
    proxy_pass http://host.docker.internal:9090;
  }
}
